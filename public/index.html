<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Peace Missile Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style> body, html { margin: 0; padding: 0; overflow: hidden; background-color: #000; } </style>
</head>
<body>
<div id="phaser-game"></div>
<script type="text/javascript">
function runGame(tg) {
    try {
        const firebaseConfig = { apiKey: "AIzaSyBtOkm8dpjVXLzAXCEB5sL_Awqq4HEeemc", authDomain: "peacemissile-game.firebaseapp.com", projectId: "peacemissile-game", storageBucket: "peacemissile-game.firebasestorage.app", messagingSenderId: "641906716058", appId: "1:641906716058:web:1376e93994fab29f049e23" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const currentUser = (tg.initDataUnsafe && tg.initDataUnsafe.user) ? tg.initDataUnsafe.user : null;

        class Preloader extends Phaser.Scene {
            constructor() { super({ key: 'Preloader' }); }
            preload() {
                this.load.image('lobby_bg', 'assets/lobby_bg.jpg');
                this.load.image('play_button', 'assets/play_button.png');
                this.load.image('israel_bg', 'assets/israel_bg.jpg');
                this.load.image('iran_bg', 'assets/iran_bg.jpg');
                this.load.image('rocket', 'assets/rocket.png');
                this.load.image('score_icon', 'assets/score_icon.png');
                this.load.image('coin_icon', 'assets/coin_icon.png');
                this.load.spritesheet('explosion', 'assets/explosion.gif', { frameWidth: 64, frameHeight: 64 });
            }
            create() { this.anims.create({ key: 'explode_anim', frames: this.anims.generateFrameNumbers('explosion'), frameRate: 20, repeat: 0, hideOnComplete: true }); this.scene.start('LobbyScene'); }
        }
  
        const config = { type: Phaser.AUTO, width: window.innerWidth, height: window.innerHeight, physics: { default: 'arcade' }, scene: [Preloader, LobbyScene, GameScene] };
        new Phaser.Game(config);
    } catch(e) {
        document.body.innerHTML = `<h1 style="color:red;">Error: ${e.message}</h1>`;
    }
}

if (window.Telegram && window.Telegram.WebApp) {
    Telegram.WebApp.ready(runGame);
} else {
    window.addEventListener('load', runGame);
}
</script>
</body>
</html>